# PostgreSQL 数据库监控工具 - Textual 版本升级说明

## 🚀 重大更新

原有的 Rich 版本已经升级为 **Textual 版本**，提供更现代化的终端用户界面和更好的用户体验。

## ✨ 新功能特性

### 1. 🎯 滚动表格替代分页
- **移除了定时翻页功能**：不再需要等待自动翻页
- **原生滚动支持**：使用方向键、鼠标滚轮或 Page Up/Down 自由浏览
- **流畅体验**：可以随时查看任何表格数据，不受分页限制

### 2. 🔍 智能过滤功能
- **多种过滤模式**：
  - `全部` - 显示所有表
  - `不一致` - 只显示数据不一致的表
  - `一致` - 只显示数据一致的表  
  - `错误` - 只显示查询出错的表
- **快速定位问题**：通过过滤快速聚焦于需要关注的表

### 3. 📊 多维度排序
- **四种排序方式**：
  - `Schema.表名` - 按模式和表名字母排序
  - `数据差异` - 按数据差异大小排序（问题优先）
  - `PG记录数` - 按 PostgreSQL 记录数排序
  - `MySQL记录数` - 按 MySQL 记录数排序

### 4. ⚡ 增强的交互体验
- **实时响应**：所有操作立即生效，无需等待
- **状态保持**：浏览位置在数据更新时保持稳定
- **直观导航**：支持键盘和鼠标操作

## 🎮 快捷键说明

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `q` / `Ctrl+C` | 退出程序 | 安全退出监控 |
| `r` | 手动刷新 | 立即更新数据 |
| `space` | 暂停/继续 | 暂停或恢复自动刷新 |
| `s` | 切换排序 | 循环切换排序方式 |
| `f` | 切换过滤 | 循环切换过滤模式 |
| `↑` / `k` | 向上移动 | 移动光标到上一行 |
| `↓` / `j` | 向下移动 | 移动光标到下一行 |
| `Home` | 跳转顶部 | 快速移动到表格顶部 |
| `End` | 跳转底部 | 快速移动到表格底部 |
| `Page Up` | 向上翻页 | 快速向上浏览 |
| `Page Down` | 向下翻页 | 快速向下浏览 |

## 🛠️ 安装和运行

### 1. 安装依赖
```bash
pip install textual rich asyncpg aiomysql
```

### 2. 运行程序
```bash
# 使用新的启动脚本
./start_monitor_new.sh

# 或直接运行
python3 cdc_monitor.py

# 指定数据库
python3 cdc_monitor.py --databases db1,db2,db3

# 使用自定义配置文件
python3 cdc_monitor.py --config my_config.ini
```

## 📋 界面说明

### 统计面板
- **运行状态**：显示运行时长、更新次数、暂停状态
- **排序和过滤**：当前的排序方式和过滤模式
- **数据统计**：PG总计、MySQL总计、数据差异
- **同步进度**：完成百分比和剩余数据量

### 数据表格
- **状态图标**：
  - ✅ 数据一致
  - ⚠️ 数据不一致  
  - ❌ 查询错误
- **实时数据**：记录数、差异、变化量、更新时间
- **颜色编码**：根据状态使用不同颜色高亮显示

## 🔧 配置说明

配置文件保持与原版本兼容，新版本会忽略分页相关配置：

```ini
[monitor]
refresh_interval = 3          # 刷新间隔（秒）
mysql_update_interval = 3     # MySQL更新间隔
# 以下配置已废弃，但不会影响运行
# page_size = 20              # 已废弃：页面大小
# page_interval = 10          # 已废弃：翻页间隔
```

## 🎯 主要优势

### 1. 用户体验提升
- **自由浏览**：不再受限于固定的分页显示
- **快速定位**：通过过滤和排序快速找到关注的表
- **即时反馈**：所有操作立即响应

### 2. 功能增强
- **智能过滤**：快速聚焦问题表格
- **多维排序**：从不同角度分析数据
- **状态保持**：浏览位置在更新时保持稳定

### 3. 性能优化
- **高效渲染**：Textual 原生支持大量数据的高效显示
- **内存友好**：只渲染可见区域，节省内存
- **响应迅速**：操作响应更快，无需等待刷新周期

## 🔄 迁移说明

### 从原版本迁移
1. **配置文件**：无需修改，完全兼容
2. **启动方式**：使用新的启动脚本 `./start_monitor_new.sh`
3. **操作习惯**：学习新的快捷键，享受更好的体验

### 保留原版本
如果需要使用原版本，可以：
1. 使用 `git` 切换到旧版本
2. 或者保留原有文件的备份

## 🐛 故障排除

### 常见问题

1. **依赖缺失**
   ```bash
   pip install textual rich asyncpg aiomysql
   ```

2. **终端兼容性**
   - 确保使用支持现代终端特性的终端
   - 推荐使用 iTerm2、Windows Terminal 或现代 Linux 终端

3. **配置文件**
   - 确保 `config.ini` 文件存在且格式正确
   - 参考 `config.ini.example` 进行配置

### 性能建议

1. **表数量较多时**：
   - 使用过滤功能聚焦关注的表
   - 适当调整刷新间隔

2. **网络延迟较高时**：
   - 增加 `refresh_interval` 和 `mysql_update_interval`
   - 使用暂停功能减少不必要的查询

## 📞 支持和反馈

如果遇到问题或有功能建议，请：
1. 检查本文档的故障排除部分
2. 查看程序输出的错误信息
3. 提交问题报告时包含配置信息和错误日志

---

**享受新的 Textual 版本带来的更好体验！** 🎉
